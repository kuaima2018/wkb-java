<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.heima.dao.WkbTaskdetailuserDao">
  <resultMap id="BaseResultMap" type="com.heima.model.WkbTaskdetailuser">
    <result column="id" jdbcType="INTEGER" property="id" />
    <result column="t_id" jdbcType="INTEGER" property="tId" />
    <result column="t_did" jdbcType="INTEGER" property="tDid" />
    <result column="u_id" jdbcType="INTEGER" property="uId" />
    <result column="t_isread" jdbcType="TINYINT" property="tIsread" />
    <result column="readdate" jdbcType="TIMESTAMP" property="readdate" />
    <result column="t_perfm" jdbcType="TINYINT" property="tPerfm" />
    <result column="perfmdate" jdbcType="TIMESTAMP" property="perfmdate" />
    <result column="t_srflag" jdbcType="TINYINT" property="tSrflag" />
    <result column="srdate" jdbcType="TIMESTAMP" property="srdate" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Apr 16 20:33:36 CST 2014.
    -->
    id, t_id, t_did, u_id, t_isread, readdate, t_perfm, perfmdate, t_srflag, srdate
  </sql>

  <insert id="saveTaskdetailuser" parameterType="com.heima.model.WkbTaskdetailuser">
    insert into wkb_taskdetailuser (t_id, t_did,u_id, t_isread, readdate,t_perfm, perfmdate, t_srflag, srdate)
    values ( #{tId,jdbcType=INTEGER}, #{tDid,jdbcType=INTEGER},
      #{uId,jdbcType=INTEGER}, #{tIsread,jdbcType=TINYINT}, #{readdate,jdbcType=TIMESTAMP},
      #{tPerfm,jdbcType=TINYINT}, #{perfmdate,jdbcType=TIMESTAMP}, #{tSrflag,jdbcType=TINYINT},  #{srdate,jdbcType=TIMESTAMP})
  </insert>

    <update id="updateDetailRecvReadByTask" parameterType="com.heima.model.WkbTaskdetailuser">
        update wkb_taskdetailuser set t_isread = #{tIsread,jdbcType=TINYINT},readdate=#{readdate,jdbcType=TIMESTAMP} where t_id=#{tId,jdbcType=INTEGER} and u_id=#{uId,jdbcType=INTEGER}
    </update>

    <select id="queryTaskUnReadCount" resultType="com.heima.dao.model.WkbUnReadCount">
        select t_id as taskId,count(t_isread) as count from wkb_taskdetailuser where t_isread=0 and
        <foreach collection="taskIdList" item="taskId" separator="or" open="(" close=")">
            t_id=#{taskId}
        </foreach>
        and u_id=#{userId} GROUP BY t_id
    </select>
</mapper>